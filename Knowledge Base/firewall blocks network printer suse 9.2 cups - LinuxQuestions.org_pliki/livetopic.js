// v1.07b
var is_chrome=navigator.userAgent.toLowerCase().indexOf('chrome')>-1;var ajax_edits=Array();var livetopic={live:false,phrases:Array(),notification:false,interval:null,interval_time:3000,get:null,old_topic:300,old_user:300,ajax_max_visibleposts:30,user_inactivity:0,init:function(){this.interval=window.setInterval(livetopic.interval_func,livetopic.interval_time);YAHOO.util.Event.addListener(window,"click",function(){livetopic.user_inactivity=0});YAHOO.util.Event.addListener(window,"focus",function(){livetopic.user_inactivity=0});YAHOO.util.Event.addListener(window,"mousemove",function(){livetopic.user_inactivity=0})},get_postcontainer:function(c){var a=livetopic.$("#posts div.page");for(var b=0,f=a.length;b<f;b++){var g=livetopic.$("table[id^='post']",a[b])[0];var e=g.id.match(/post(\d+)/)[1];if(c==e)return a[b].parentNode}},display_posts:function(){YAHOO.util.Connect.asyncRequest('POST','ajax.php?do=shownewresponses',{success:function(c){var a=c.responseXML;var b=a.getElementsByTagName('db_ajax_last_post').item(0).childNodes.item(0)!==null?a.getElementsByTagName('db_ajax_last_post').item(0).childNodes.item(0).nodeValue:null;var f=a.getElementsByTagName('db_ajax_last_edit').item(0).childNodes.item(0)!==null?a.getElementsByTagName('db_ajax_last_edit').item(0).childNodes.item(0).nodeValue:null;if(b!=null||f!=null){var b=parseInt(b);var f=parseInt(f);var g=a.getElementsByTagName('postbit');for(var e=0,o=g.length;e<o;e++){var d=g[e].getAttribute('postid');var s=g[e].getAttribute('dateline');var p=g[e].getAttribute('lastedit');var m=g[e].childNodes.item(0).nodeValue;var n=p>ajax_last_edit?'editpost':'newpost';if(n=='newpost'&&!fetch_object('post'+d)){var h=document.createElement("div");h.innerHTML=m;h.style.display='none';var i=fetch_object("lastpost");var j=i.parentNode;var k=j.insertBefore(h,i);PostBit_Init(k,d);fetch_object('post'+d).style.opacity="1";h.style.display='block';var q={opacity:{from:1,to:1}};var l=new YAHOO.util.Anim('post'+d,q);l.animate();livetopic.fade_posts()}else if(n=='editpost'&&fetch_object('post'+d)&&!ajax_edits[d]){var r=livetopic.$("#postcount"+4+" strong").length>0?livetopic.$("#postcount"+4+" strong")[0].innerHTML:0;var i=livetopic.get_postcontainer(d);var h=document.createElement("div");h.style.display='none';var j=i.parentNode;var k=j.insertBefore(h,i);j.removeChild(i);h.innerHTML=String(m).replace(/___postcount_placeholder___/ig,r);fetch_object('post_message_'+d).innerHTML='<div class="livetopic-editnotice">'+vbphrase['livetopic_edit_message']+'</div>'+fetch_object('post_message_'+d).innerHTML;h.style.display='block';var l=new YAHOO.util.Anim('post'+d,{opacity:{from:1,to:1}});l.animate();PostBit_Init(k,d)}}ajax_last_post=b>ajax_last_post?b:ajax_last_post;ajax_last_edit=f>ajax_last_edit?f:ajax_last_edit}}},'securitytoken='+SECURITYTOKEN+'&threadid='+threadid+'&ajax_lastpost='+ajax_last_post+'&ajax_lastedit='+ajax_last_edit)},display_notification:function(){YAHOO.util.Connect.asyncRequest('POST','ajax.php?do=shownewnotifications',{success:function(c){var a=c.responseXML;var b=parseInt(a.getElementsByTagName('new').item(0).childNodes.item(0).nodeValue);if(b>0&&fetch_object('presence-container')){var f=fetch_object('presence-container').getElementsByTagName('div')[0];f.innerHTML=vbphrase['livetopic_newresponses'].replace(/%1/,b).replace(/%2/,threadid);if(livetopic.notification===false){var g={height:{from:0,by:32,unit:'px'},opacity:{from:1,to:1}};var e=new YAHOO.util.Anim('presence-container',g);e.animate();livetopic.notification=true}}}},'securitytoken='+SECURITYTOKEN+'&threadid='+threadid+'&ajax_lastpost='+ajax_last_post)},fade_posts:function(){P=livetopic.$("#posts div.page table[id^='post']");PC=livetopic.$("#posts div.page");if(P.length>4&&P.length>livetopic.ajax_max_visibleposts){if(!fetch_object("livetopic_maxposts_notice")){var c=document.createElement("div");c.id="livetopic_maxposts_notice";c.innerHTML='<div align="center"><div style="width: 100%; text-align: left;" class="page"><div align="left" style="padding: 1px 25px;"><div class="livetopic-maxpostnotice">'+vbphrase['livetopic_maxpostnotice']+'</div></div></div></div>';fetch_object("posts").insertBefore(c,PC[0].parentNode)}fetch_object("posts").removeChild(PC[0].parentNode);P[1].style.opacity=".30";P[2].style.opacity=".50";P[3].style.opacity=".80"}else if(P.length>livetopic.ajax_max_visibleposts-1){P[0].style.opacity=".30";P[1].style.opacity=".50";P[2].style.opacity=".80"}else if(P.length>livetopic.ajax_max_visibleposts-2){P[0].style.opacity=".50";P[1].style.opacity=".80"}else if(P.length>livetopic.ajax_max_visibleposts-3){P[0].style.opacity=".80"}},interval_func:function(){if(livetopic.user_inactivity<livetopic.old_user){var c=Math.floor(new Date().getTime()/1000);var a=c-ajax_last_post;if((is_moz||is_saf||is_ie7||is_opera||is_chrome)&&is_last_page!==1&&a<livetopic.old_topic){livetopic.display_notification()}else if(a<livetopic.old_topic){livetopic.live=true;livetopic.display_posts()}else{livetopic.live=false}}livetopic.user_inactivity+=livetopic.interval_time/1000}};
livetopic.$ = function(){var version="2.0.2";var $COMMA=/\s*,\s*/;var dom_query=function($selector,$$from){try{var $match=[];var $useCache=arguments.callee.caching&&!$$from;var $base=($$from)?($$from.constructor==Array)?$$from:[$$from]:[document];var $$selectors=parseSelector($selector).split($COMMA),i;for(i=0;i<$$selectors.length;i++){$selector=_toStream($$selectors[i]);if(isMSIE&&$selector.slice(0,3).join("")==" *#"){$selector=$selector.slice(2);$$from=_msie_selectById([],$base,$selector[1])}else $$from=$base;var j=0,$token,$filter,$arguments,$cacheSelector="";while(j<$selector.length){$token=$selector[j++];$filter=$selector[j++];$cacheSelector+=$token+$filter;$arguments="";if($selector[j]=="("){while($selector[j++]!=")"&&j<$selector.length){$arguments+=$selector[j]}$arguments=$arguments.slice(0,-1);$cacheSelector+="("+$arguments+")"}$$from=($useCache&&cache[$cacheSelector])?cache[$cacheSelector]:select($$from,$token,$filter,$arguments);if($useCache)cache[$cacheSelector]=$$from}$match=$match.concat($$from)}delete dom_query.error;return $match}catch($error){dom_query.error=$error;return[]}};dom_query.toString=function(){return"function dom_query() {\n  [version "+version+"]\n}"};var cache={};dom_query.caching=false;dom_query.clearCache=function($selector){if($selector){$selector=_toStream($selector).join("");delete cache[$selector]}else cache={}};var modules={};var loaded=false;dom_query.addModule=function($name,$script){if(loaded)eval("$script="+String($script));modules[$name]=new $script()};dom_query.valueOf=function($code){return $code?eval($code):this};var selectors={};var pseudoClasses={};var AttributeSelector={match:/\[([\w-]+(\|[\w-]+)?)\s*(\W?=)?\s*([^\]]*)\]/};var attributeSelectors=[];selectors[" "]=function($results,$from,$tagName,$namespace){var $element,i,j;for(i=0;i<$from.length;i++){var $subset=getElementsByTagName($from[i],$tagName,$namespace);for(j=0;($element=$subset[j]);j++){if(thisElement($element)&&compareNamespace($element,$namespace))$results.push($element)}}};selectors["#"]=function($results,$from,$id){var $element,j;for(j=0;($element=$from[j]);j++)if($element.id==$id)$results.push($element)};selectors["."]=function($results,$from,$className){$className=new RegExp("(^|\\s)"+$className+"(\\s|$)");var $element,i;for(i=0;($element=$from[i]);i++)if($className.test($element.className))$results.push($element)};selectors[":"]=function($results,$from,$pseudoClass,$arguments){var $test=pseudoClasses[$pseudoClass],$element,i;if($test)for(i=0;($element=$from[i]);i++)if($test($element,$arguments))$results.push($element)};pseudoClasses["link"]=function($element){var $document=getDocument($element);if($document.links)for(var i=0;i<$document.links.length;i++){if($document.links[i]==$element)return true}};pseudoClasses["visited"]=function($element){};var thisElement=function($element){return($element&&$element.nodeType==1&&$element.tagName!="!")?$element:null};var previousElementSibling=function($element){while($element&&($element=$element.previousSibling)&&!thisElement($element))continue;return $element};var nextElementSibling=function($element){while($element&&($element=$element.nextSibling)&&!thisElement($element))continue;return $element};var firstElementChild=function($element){return thisElement($element.firstChild)||nextElementSibling($element.firstChild)};var lastElementChild=function($element){return thisElement($element.lastChild)||previousElementSibling($element.lastChild)};var childElements=function($element){var $childElements=[];$element=firstElementChild($element);while($element){$childElements.push($element);$element=nextElementSibling($element)}return $childElements};var isMSIE=true;var isXML=function($element){var $document=getDocument($element);return(typeof $document.mimeType=="unknown")?/\.xml$/i.test($document.URL):Boolean($document.mimeType=="XML Document")};var getDocument=function($element){return $element.ownerDocument||$element.document};var getElementsByTagName=function($element,$tagName){return($tagName=="*"&&$element.all)?$element.all:$element.getElementsByTagName($tagName)};var compareTagName=function($element,$tagName,$namespace){if($tagName=="*")return thisElement($element);if(!compareNamespace($element,$namespace))return false;if(!isXML($element))$tagName=$tagName.toUpperCase();return $element.tagName==$tagName};var compareNamespace=function($element,$namespace){return!$namespace||($namespace=="*")||($element.scopeName==$namespace)};var getTextContent=function($element){return $element.innerText};function _msie_selectById($results,$from,id){var $match,i,j;for(i=0;i<$from.length;i++){if($match=$from[i].all.item(id)){if($match.id==id)$results.push($match);else if($match.length!=null){for(j=0;j<$match.length;j++){if($match[j].id==id)$results.push($match[j])}}}}return $results};if(![].push)Array.prototype.push=function(){for(var i=0;i<arguments.length;i++){this[this.length]=arguments[i]}return this.length};var $NAMESPACE=/\|/;function select($$from,$token,$filter,$arguments){if($NAMESPACE.test($filter)){$filter=$filter.split($NAMESPACE);$arguments=$filter[0];$filter=$filter[1]}var $results=[];if(selectors[$token]){selectors[$token]($results,$$from,$filter,$arguments)}return $results};var $STANDARD_SELECT=/^[^\s>+~]/;var $$STREAM=/[\s#.:>+~()@]|[^\s#.:>+~()@]+/g;function _toStream($selector){if($STANDARD_SELECT.test($selector))$selector=" "+$selector;return $selector.match($$STREAM)||[]};var $WHITESPACE=/\s*([\s>+~(),]|^|$)\s*/g;var $IMPLIED_ALL=/([\s>+~,]|[^(]\+|^)([#.:@])/g;var parseSelector=function($selector){return $selector.replace($WHITESPACE,"$1").replace($IMPLIED_ALL,"$1*$2")};var Quote={toString:function(){return"'"},match:/^('[^']*')|("[^"]*")$/,test:function($string){return this.match.test($string)},add:function($string){return this.test($string)?$string:this+$string+this},remove:function($string){return this.test($string)?$string.slice(1,-1):$string}};var getText=function($text){return Quote.remove($text)};var $ESCAPE=/([\/()[\]?{}|*+-])/g;function regEscape($string){return $string.replace($ESCAPE,"\\$1")};loaded=true;return dom_query}();
livetopic.$.addModule("chad",function(){isMSIE=eval("false;/*@cc_on@if(@\x5fwin32)isMSIE=true@end@*/");if(!isMSIE){getElementsByTagName=function(a,b,c){return c?a.getElementsByTagNameNS("*",b):a.getElementsByTagName(b)};compareNamespace=function(a,b){return!b||(b=="*")||(a.prefix==b)};isXML=document.contentType?function(a){return/xml/i.test(getDocument(a).contentType)}:function(a){return getDocument(a).documentElement.tagName!="HTML"};getTextContent=function(a){return a.textContent||a.innerText||e(a)};function e(a){var b="",c,d;for(d=0;(c=a.childNodes[d]);d++){switch(c.nodeType){case 11:case 1:b+=e(c);break;case 3:b+=c.nodeValue;break}}return b}}});
livetopic.$.addModule("is",function(){selectors[">"]=function(a,b,f,e){var d,c,g;for(c=0;c<b.length;c++){var h=childElements(b[c]);for(g=0;(d=h[g]);g++)if(compareTagName(d,f,e))a.push(d)}};selectors["+"]=function(a,b,f,e){for(var d=0;d<b.length;d++){var c=nextElementSibling(b[d]);if(c&&compareTagName(c,f,e))a.push(c)}};selectors["@"]=function(a,b,f){var e=attributeSelectors[f].test;var d,c;for(c=0;(d=b[c]);c++)if(e(d))a.push(d)};pseudoClasses["first-child"]=function(a){return!previousElementSibling(a)};pseudoClasses["lang"]=function(a,b){b=new RegExp("^"+b,"i");while(a&&!a.getAttribute("lang"))a=a.parentNode;return a&&b.test(a.getAttribute("lang"))};AttributeSelector.NS_IE=/\\:/g;AttributeSelector.PREFIX="@";AttributeSelector.tests={};AttributeSelector.replace=function(a,b,f,e,d){var c=this.PREFIX+a;if(!attributeSelectors[c]){b=this.create(b,e||"",d||"");attributeSelectors[c]=b;attributeSelectors.push(b)}return attributeSelectors[c].id};AttributeSelector.parse=function(a){a=a.replace(this.NS_IE,"|");var b;while(b=a.match(this.match)){var f=this.replace(b[0],b[1],b[2],b[3],b[4]);a=a.replace(this.match,f)}return a};AttributeSelector.create=function(a,b,f){var e={};e.id=this.PREFIX+attributeSelectors.length;e.name=a;b=this.tests[b];b=b?b(this.getAttribute(a),getText(f)):false;e.test=new Function("e","return "+b);return e};AttributeSelector.getAttribute=function(a){switch(a.toLowerCase()){case"id":return"e.id";case"class":return"e.className";case"for":return"e.htmlFor";case"href":if(isMSIE){return"String((e.outerHTML.match(/href=\\x22?([^\\s\\x22]*)\\x22?/)||[])[1]||'')"}}return"e.getAttribute('"+a.replace($NAMESPACE,":")+"')"};AttributeSelector.tests[""]=function(a){return a};AttributeSelector.tests["="]=function(a,b){return a+"=="+Quote.add(b)};AttributeSelector.tests["~="]=function(a,b){return"/(^| )"+regEscape(b)+"( |$)/.test("+a+")"};AttributeSelector.tests["|="]=function(a,b){return"/^"+regEscape(b)+"(-|$)/.test("+a+")"};var i=parseSelector;parseSelector=function(a){return i(AttributeSelector.parse(a))}});
livetopic.$.addModule("sexy",function(){selectors["~"]=function(a,b,c,d){var e,g;for(g=0;(e=b[g]);g++){while(e=nextElementSibling(e)){if(compareTagName(e,c,d))a.push(e)}}};pseudoClasses["contains"]=function(a,b){b=new RegExp(regEscape(getText(b)));return b.test(getTextContent(a))};pseudoClasses["root"]=function(a){return a==getDocument(a).documentElement};pseudoClasses["empty"]=function(a){var b,c;for(c=0;(b=a.childNodes[c]);c++){if(thisElement(b)||b.nodeType==3)return false}return true};pseudoClasses["last-child"]=function(a){return!nextElementSibling(a)};pseudoClasses["only-child"]=function(a){a=a.parentNode;return firstElementChild(a)==lastElementChild(a)};pseudoClasses["not"]=function(a,b){var c=dom_query(b,getDocument(a));for(var d=0;d<c.length;d++){if(c[d]==a)return false}return true};pseudoClasses["nth-child"]=function(a,b){return j(a,b,previousElementSibling)};pseudoClasses["nth-last-child"]=function(a,b){return j(a,b,nextElementSibling)};pseudoClasses["target"]=function(a){return a.id==location.hash.slice(1)};pseudoClasses["checked"]=function(a){return a.checked};pseudoClasses["enabled"]=function(a){return a.disabled===false};pseudoClasses["disabled"]=function(a){return a.disabled};pseudoClasses["indeterminate"]=function(a){return a.indeterminate};AttributeSelector.tests["^="]=function(a,b){return"/^"+regEscape(b)+"/.test("+a+")"};AttributeSelector.tests["$="]=function(a,b){return"/"+regEscape(b)+"$/.test("+a+")"};AttributeSelector.tests["*="]=function(a,b){return"/"+regEscape(b)+"/.test("+a+")"};function j(b,c,d){switch(c){case"n":return true;case"even":c="2n";break;case"odd":c="2n+1"}var e=childElements(b.parentNode);function g(a){var a=(d==nextElementSibling)?e.length-a:a-1;return e[a]==b};if(!isNaN(c))return g(c);c=c.split("n");var h=parseInt(c[0]);var f=parseInt(c[1]);if((isNaN(h)||h==1)&&f==0)return true;if(h==0&&!isNaN(f))return g(f);if(isNaN(f))f=0;var i=1;while(b=d(b))i++;if(isNaN(h)||h==1)return(d==nextElementSibling)?(i<=f):(f>=i);return(i%h)==f}});
if(typeof ajax_last_post!='undefined'&&threaded_mode===0){YAHOO.util.Event.onDOMReady(livetopic.init);function qr_do_ajax_post(b){if(b.responseXML){document.body.style.cursor="auto";fetch_object("qr_posting_msg").style.display="none";var a;if(fetch_tag_count(b.responseXML,"postbit")){qr_disable_controls();qr_hide_errors();var c=b.responseXML.getElementsByTagName("postbit");for(a=0;a<c.length;a++){if(livetopic.live===false){ajax_last_post=parseInt(b.responseXML.getElementsByTagName("time")[0].firstChild.nodeValue)}else{livetopic.fade_posts()}if(!fetch_object('post'+c[a].getAttribute("postid"))||livetopic.live==false){var f=document.createElement("div");f.innerHTML=c[a].firstChild.nodeValue;var g=fetch_object("lastpost");var h=g.parentNode;var i=h.insertBefore(f,g);PostBit_Init(i,c[a].getAttribute("postid"))}}if(fetch_object("qr_submit")){fetch_object("qr_submit").blur()}qr_activate();vB_Editor["vB_Editor_QR"].check_focus()}else{if(!is_saf){var d=b.responseXML.getElementsByTagName("error");if(d.length){var e="<ol>";for(a=0;a<d.length;a++){e+="<li>"+d[a].firstChild.nodeValue+"</li>"}e+="</ol>";qr_show_errors("<ol>"+e+"</ol>");return false}}qr_resubmit()}}else{qr_resubmit()}}if(typeof vB_AJAX_QuickEditor!='undefined'){vB_AJAX_QuickEditor.prototype.save=function(b){ajax_edits[vB_QuickEditor.postid]=true;var a=vB_Editor[vB_QuickEditor.editorid].get_editor_contents();var c=vB_Editor[vB_QuickEditor.editorid];if(a==vB_QuickEditor.unchanged&&c==vB_QuickEditor.unchanged_reason){vB_QuickEditor.abort(b)}else{fetch_object(vB_QuickEditor.editorid+"_posting_msg").style.display="";document.body.style.cursor="wait";pc_obj=fetch_object("postcount"+vB_QuickEditor.postid);this.ajax_req=YAHOO.util.Connect.asyncRequest("POST","editpost.php?do=updatepost&postid="+this.postid,{success:vB_QuickEditor.update,failure:vB_QuickEditor.handle_save_error,timeout:vB_Default_Timeout,scope:vB_QuickEditor},SESSIONURL+"securitytoken="+SECURITYTOKEN+"&do=updatepost&ajax=1&postid="+vB_QuickEditor.postid+"&wysiwyg="+vB_Editor[vB_QuickEditor.editorid].wysiwyg_mode+"&message="+PHP.urlencode(a)+"&reason="+PHP.urlencode(fetch_object(vB_QuickEditor.editorid+"_edit_reason").value)+(pc_obj!=null?"&postcount="+PHP.urlencode(pc_obj.name):""));vB_QuickEditor.pending=true}}}}
