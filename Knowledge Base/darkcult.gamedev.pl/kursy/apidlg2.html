<script type="text/javascript" language="JavaScript"><!--  document.write (unescape ('%3cscript type="text/javascript" '+' src="http://kropka.onet.pl/_s/kropka/r.js?id=B8XlFCO1yU.kxYbVHvZDL8Q8HSeKoi8AdrFAxSxBYoj.s7&t=1&z=0&k=0&RR='+(new Date()).getTime()+'"%3e%3c/script%3e'));  //--></script> 
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="content-type" CONTENT="text/html; charset=windows-1250">
<META NAME="Language" CONTENT="pl">
<META NAME="Author" CONTENT="Twój nocny koszmar">
<META NAME="Generator" CONTENT="Notatnik :-)">

<TITLE>Dark Cult of C++ - WinAPI - Dialogi niemodalne</TITLE>
<LINK REL=stylesheet HREF="kurs.css" TYPE="text/css">
</HEAD>

<BODY STYLE="font-family: Verdana; font-size: 9pt; color: #CCCCCC; background-color: #464646;">
<TABLE ALIGN=CENTER>
<TR>
<TD CLASS=TDN>
<A HREF="apidlg.html"><< Poprzednia czêœæ kursu</A> &nbsp;
<A HREF="../winapi.html">Spis</A> &nbsp;
<A HREF="../index.html" TARGET="_top">Strona g³ówna</A> &nbsp;
<A HREF="apidlg3.html">Nastêpna czêœæ kursu >></A> &nbsp; 
</TD>
</TR>
</TABLE>
<HR COLOR=GRAY WIDTH=90% SIZE=1>

<H1>
Okna dialogowe niemodalne
</H1>

<P>
Takie okienka dialogowe, o jakich mówiliœmy do tej pory, nie do wszystkiego da siê wykorzystaæ. I tak na przyk³ad jeœli chcemy zrobiæ aplikacjê sk³adaj¹c¹ siê z kilku okien widocznych za ekranie jednoczeœnie (np. jedno okno g³ówne i drugie okno jako pasek narzêdzi), dialogi modalne staj¹ siê kompletnie nieprzydatne, poniewa¿ taki dialog trzeba zamkn¹æ, by móc znów korzystaæ z g³ównego okna.
</P>
<P>
Dialogi <SPAN CLASS=Wazne>niemodalne</SPAN> (<SPAN CLASS=Inglisz>modeless dialogs</SPAN>) nie posiadaj¹ w³asnej pêtli komunikatów. Wszystko, co siê na nich dzieje, wysy³ane jest do okna-rodzica. Zreszt¹ w tym przypadku okreœlenia "okno-rodzic" i "okno-dziecko" s¹ bardzo adekwatne do sytuacji: niemodalne okna dialogowe s¹ "niesamodzielne" i ca³kowicie podleg³e swym "rodzicom".
</P>
<P>
Po tej szczypcie teorii czas zakasaæ rêkawy i braæ siê do roboty, czyli do stworzenia takiego niemodalnego okna dialogowego. Za³ó¿my, ¿e chcemy mieæ pasek narzêdzi z trzema przyciskami. Czyli coœ takiego:
</P>

<P ALIGN=CENTER>
<IMG SRC="../gfx/modeless.gif" ALT="Niemodalny dialog w roli paska narzêdziowego">
</P>

<P>
Zaczniemy od edycji pliku *.rc:
</P>

<TABLE BORDER WIDTH=100%>
<TR><TD><SPAN CLASS=C>
#include &lt;windows.h&gt;<BR>
#include "pasek.h"</SPAN><BR>
<BR>
IDD_PASEK <SPAN CLASS=K>DIALOGEX</SPAN> <SPAN CLASS=L>0, 0, 98, 52</SPAN><BR>
<SPAN CLASS=K>STYLE</SPAN> DS_MODALFRAME | WS_POPUP | WS_CAPTION<BR>
<SPAN CLASS=K>EXSTYLE</SPAN> WS_EX_TOOLWINDOW<BR>
<SPAN CLASS=K>CAPTION</SPAN> <SPAN CLASS=L>"Mój pasek narzêdzi"</SPAN><BR>
<SPAN CLASS=K>FONT</SPAN> <SPAN CLASS=L>8, "MS Sans Serif"</SPAN><BR>
{<BR>
&nbsp;<SPAN CLASS=K>PUSHBUTTON</SPAN> <SPAN CLASS=L>"&Pierwszy przycisk"</SPAN>, IDC_PRZYC1, <SPAN CLASS=L>7,7,84,14</SPAN><BR>
&nbsp;<SPAN CLASS=K>PUSHBUTTON</SPAN> <SPAN CLASS=L>"&Drugi przycisk"</SPAN>, IDC_PRZYC2, <SPAN CLASS=L>7,31,84,14</SPAN><BR>
&nbsp;<SPAN CLASS=K>PUSHBUTTON</SPAN> <SPAN CLASS=L>"&Trzeci przycisk"</SPAN>, IDC_PRZYC3, <SPAN CLASS=L>7,31,84,14</SPAN><BR>
}<BR>
</TD></TR>
</TABLE>

<P>
Nag³ówek <SPAN CLASS=C>pasek.h</SPAN> mo¿e wygl¹daæ jakoœ tak:
</P>

<TABLE BORDER WIDTH=100%>
<TR><TD>
<SPAN CLASS=C>
#define IDD_PASEK &nbsp;200<BR>
#define IDC_PRZYC1 201<BR>
#define IDC_PRZYC1 202<BR>
#define IDC_PRZYC1 203<BR>
</SPAN>
</TD></TR>
</TABLE>

<P>
Jak widaæ, powy¿szy plik zasobów nie ró¿ni siê zbytnio od tego dla dialogu modalnego. Wstawi³em go tylko po to, by pokazaæ, jak okreœlaæ rozszerzone opcje stylów w pliku zasobów. Dla naszego dialogu u¿yjemy rozszerzonego stylu <SPAN CLASS=T>WS_EX_TOOLWINDOW</SPAN>, który zamienia nasze okienko na pasek narzêdzi. Charakteryzuje siê on przede wszystkim mniejszym paskiem tytu³owym. Jeœli chcemy skorzystaæ z rozszerzonych stylów dla dialogu, definiujemy go w pliku *.rc s³owem <SPAN CLASS=K>DIALOGEX</SPAN> (zamiast zwyk³ego <SPAN CLASS=K>DIALOG</SPAN>). Sta³e rozszerzonych stylów podajemy po s³owie <SPAN CLASS=K>EXSTYLE</SPAN>.
</P>
<P>
Oczywiœcie rozszerzone style mo¿na równie dobrze stosowaæ dla dialogów niemodalnych jak i modalnych. W budowie pliku zasobów tych dwóch rodzajów dialogów nie ma, jak ju¿ powiedzia³em, ¿adnej ró¿nicy. Pojawia siê ona dopiero przy makrze wywo³uj¹cym dialog. Dla dialogów niemodalnych bêdzie to <SPAN CLASS=T>CreateDialog</SPAN>. Sk³adnia jest identyczna, jak w przypadku <SPAN CLASS=T>DialogBox</SPAN>:
</P>

<TABLE WIDTH=100%>
<TR><TD CLASS=ARGLIST COLSPAN=2>
<SPAN CLASS=K>int</SPAN> CreateDialog(<I>HINSTANCE hInstance, LPCTSTR lpTemplate, HWND hWndParent, DLGPROC lpDialogFunc</I>)
</TD></TR><TR></TR><TR></TR><TR></TR>
<TR><TH CLASS=ARGLIST>Argument</TH><TH CLASS=ARGLIST>Znaczenie</TH></TR>
<TR><TD CLASS=ARGLIST><I>hInstance</I></TD><TD CLASS=ARGLIST>Uchwyt do naszej aplikacji</TD></TR>
<TR><TD CLASS=ARGLIST><I>lpTemplate</I></TD><TD CLASS=ARGLIST>Identyfikator wzorca dialogu</TD></TR> 
<TR><TD CLASS=ARGLIST><I>hWndParent</I></TD><TD CLASS=ARGLIST>Uchwyt okna wywo³uj¹cego dialog</TD></TR>
<TR><TD CLASS=ARGLIST><I>lpDialogFunc</I></TD><TD CLASS=ARGLIST>WskaŸnik do procedury dialogowej</TD></TR>
</TABLE>

<P>
Podobna jest te¿ budowa procedury dialogowej dialogu niemodalnego. Jedyna istotna ró¿nica to sposób zamykania dialogu. Tym razem nie wywo³ujemy <SPAN CLASS=T>EndDialog</SPAN>, tylko niszczymy okno poleceniem <SPAN CLASS=T>DestroyWindow</SPAN>, tak jak w przypadku "zwyk³ego" (nie-dialogowego) okna. Oczywiœcie okno niszczymy zazwyczaj tylko raz, a konkretnie przy wychodzeniu z programu. Czasami jednak u¿ytkownik mo¿e zapragn¹æ schowaæ na jakiœ czas swój pasek narzêdzi (np. ¿eby nie zas³ania³ mu uroczego widoku na inne okienko ;-)), a póŸniej znowu je pokazaæ, gdy bêdzie potrzebne. Wtedy mo¿emy skorzystaæ z us³ug funkcji <SPAN CLASS=T>ShowWindow</SPAN>. Ukrywamy okno tak:
</P>

<TABLE BORDER WIDTH=100%>
<TR><TD>
ShowWindow(hwnd, SW_HIDE);
</TD></TR>
</TABLE>

<P>
...a z powrotem pokazujemy tak:
</P>

<TABLE BORDER WIDTH=100%>
<TR><TD>
ShowWindow(hwnd, SW_SHOW);
</TD></TR>
</TABLE>

<P>
Kodu przyk³adowego wykorzystuj¹cego dialog niemodalny nie bêdzie, gdy¿ jest on prawie identyczny z tym do dialogów modalnych (a tak naprawdê to nie chce mi siê go kopiowaæ ;-)).
</P>

<H2>
DOMYŒLNA OBS£UGA KOMUNIKATÓW
</H2>

<P>
Uczyniwszy nasz dialog niemodalnym, pozbawiliœmy go przy okazji pewnej cennej cechy: domyœlnej obs³ugi prze³¹czania siê miêdzy kontrolkami za pomoc¹ klawisza TAB. Na szczêœcie jest na to sposób. Wystarczy wywo³aæ funkcjê <SPAN CLASS=T>IsDialogMessage</SPAN>. Jak sugeruje nazwa, funkcja ta sprawdza, czy podany komunikat pochodzi od podanego dialogu, czy te¿ nie. Jeœli pochodzi, funkcja obs³u¿y ten komunikat (zapewniaj¹c przy okazji automatyczn¹ obs³ugê TAB-a) i zwróci <SPAN CLASS=T>TRUE</SPAN>. Tak wiêc modyfikuj¹c pêtlê komunikatów w nastêpuj¹cy sposób:
</P>

<TABLE BORDER WIDTH=100%>
<TR><TD>
<SPAN CLASS=K>while</SPAN>(GetMessage(&msg, NULL, <SPAN CLASS=L>0, 0</SPAN>))<BR>
{<BR>
&nbsp;<SPAN CLASS=K>if</SPAN>(!IsDialogMessage(hPasek, &msg))<BR>
&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;TranslateMessage(&msg);<BR>
&nbsp;&nbsp;&nbsp;DispatchMessage(&msg);<BR>
&nbsp;&nbsp;}<BR>
}<BR>
</TD></TR>
</TABLE>

<P>
...zyskujemy automatyczn¹ obs³ugê TAB-a równie¿ w niemodalnym dialogu. Co wiêcej, sztuczkê tê mo¿na wykorzystaæ tak¿e dla "zwyk³ego" okna, podaj¹c funkcji <SPAN CLASS=T>IsDialogMessage</SPAN> uchwyt tego okna jako argument! G³upi Windows pomyœli sobie, ¿e okno jest dialogiem i zapewni mu obs³ugê TAB-a :-). 
</P>


<HR COLOR=GRAY WIDTH=90% SIZE=1>
<TABLE ALIGN=CENTER>
<TR>
<TD CLASS=TDN>
<A HREF="apidlg.html"><< Poprzednia czêœæ kursu</A> &nbsp;
<A HREF="../winapi.html">Spis</A> &nbsp;
<A HREF="../index.html" TARGET="_top">Strona g³ówna</A> &nbsp;
<A HREF="apidlg3.html">Nastêpna czêœæ kursu >></A> &nbsp;
</TD>
</TR>
</TABLE>

</HTML>