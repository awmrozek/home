<script type="text/javascript" language="JavaScript"><!--  document.write (unescape ('%3cscript type="text/javascript" '+' src="http://kropka.onet.pl/_s/kropka/r.js?id=B8XlFCO1yU.kxYbVHvZDL8Q8HSeKoi8AdrFAxSxBYoj.s7&t=1&z=0&k=0&RR='+(new Date()).getTime()+'"%3e%3c/script%3e'));  //--></script> 

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="content-type" CONTENT="text/html; charset=windows-1250">
<META NAME="Language" CONTENT="pl">
<META NAME="Author" CONTENT="Twój nocny koszmar">
<META NAME="Generator" CONTENT="Notatnik :-)">

<TITLE>Dark Cult of C++ - WinAPI - Predefiniowane dialogi</TITLE>
<LINK REL=stylesheet HREF="kurs.css" TYPE="text/css">
</HEAD>

<BODY STYLE="font-family: Verdana; font-size: 9pt; color: #CCCCCC; background-color: #464646;">
<TABLE ALIGN=CENTER>
<TR>
<TD CLASS=TDN>
<A HREF="apidlg2.html">&lt;&lt; Poprzednia czêœæ kursu</A> &nbsp;
<A HREF="../winapi.html">Spis</A> &nbsp;
<A HREF="../index.html" TARGET="_top">Strona g³ówna</A> &nbsp;
<A HREF="apidlg4.html">Nastêpna czêœæ kursu &gt;&gt;</A> &nbsp;
</TD>
</TR>
</TABLE>
<HR COLOR=GRAY WIDTH=90% SIZE=1>

<H1>
Powszechnie u¿ywane dialogi
</H1>

<P>
Nie trzeba byæ koniecznie programist¹ by wiedzieæ, ¿e nie ma sensu wywa¿aæ otwartych drzwi. A programista to w dodatku skrajnie wygodne stworzenie i lubi wykorzystywaæ czyj¹œ pracê, jeœli tylko siê da. I s³usznie, bo gdyby ka¿dy musia³ wszystko robiæ na w³asn¹ rêkê i od zera, to nie by³oby postêpu ;-).
</P>
<P>
Kieruj¹c siê tymi m¹droœciami panowie z Microsoftu wykombinowali sobie, coby do³¹czyæ do swego systemu kilka predefiniowanych dialogów. I tak na przyk³ad prawie ka¿dy program odczytuje lub zapisuje jakieœ pliki - wczeœniej jednak u¿ytkownik musi podaæ nazwê i œcie¿kê do takiego pliku. Nie trzeba byæ specjalnie spostrzegawczym by skonstatowaæ, ¿e wiêkszoœæ programów u¿ywa do wyboru pliku jednego i tego samego okienka dialogwego. Podobnie ma siê rzecz z dialogiem wyboru czcionki czy koloru. Takie dialogi nosz¹ urocze miano <SPAN CLASS=Inglisz>common dialogs</SPAN>, co mo¿na przet³umaczyæ jako "wspólne" lub "powszechnie u¿ywane", a najlepiej jedno i drugie naraz :-).
</P>

<H2>
Dialog wyboru pliku
</H2>

<P>
W ramach praktycznej nauki zmajstrujemy sobie coœ w rodzaju windowsowego Notatnika - aplikacjê, która po wciœniêciu odpowiedniego przycisku bêdzie pokazywa³a dialog wyboru pliku, po czym bêdzie wczytywa³a wybrany przez u¿ytkownika plik do pola tekstowego. A wiêc coœ takiego:
</P>

<P ALIGN=CENTER>
<IMG SRC="../gfx/cdl.gif" ALT="Nasz pseudo-notatnik w akcji;-)">
</P>

<P>
Samo wywo³anie dialogu wyboru pliku na scenê to wyj¹tkowo proste zadanie:
</P>

<TABLE BORDER WIDTH=100%>
<TR><TD>
OPENFILENAME ofn;<BR>
<SPAN CLASS=C>//jeœli otwieramy plik do odczytu...</SPAN><BR>
GetOpenFileName(&ofn);<BR>
<SPAN CLASS=C>//...lub GetSaveFileName(&ofn), jeœli zapisujemy</SPAN><BR>
</TD></TR>
</TABLE>


<P>
Pewnie siê domyœlasz, ¿e struktura <SPAN CLASS=T>OPENFILENAME</SPAN> zawiera rozmaite przydatne opcje naszego dialogu. Tak wiêc taki sposób u¿ycia jej jak powy¿ej spowoduje w najlepszym wypadku otwarcie dialogu zupe³nie inaczej wygl¹daj¹cego, ni¿ sobie zaplanowaliœmy. Tak wiêc strukturê nale¿a³oby wype³niæ. Aby wype³niæ, musimy coœ niecoœ o niej wiedzieæ, wiêc rzuæmy okiem na szczegó³y (uwaga, jest ich doœæ sporo ;-)):
</P>

<TABLE WIDTH=100%>
<TR><TH CLASS=ARGLIST>Sk³adowa</TH><TH CLASS=ARGLIST>Typ</TH><TH CLASS=ARGLIST>Znaczenie</TH></TR>
<TR><TD CLASS=ARGLIST><I>lStructSize</I></TD><TD CLASS=ARGLIST>DWORD</TD><TD CLASS=ARGLIST>Rozmiar struktury w bajtach</TD></TR>
<TR><TD CLASS=ARGLIST><I>hwndOwner</I></TD><TD CLASS=ARGLIST>HWND</TD><TD CLASS=ARGLIST>Uchwyt okna-w³aœciciela dialogu, mo¿e byæ NULL</TD></TR>
<TR><TD CLASS=ARGLIST><I>lpstrFilter</I></TD><TD CLASS=ARGLIST>LPCTSTR</TD><TD CLASS=ARGLIST>Filtr dla wyœwietlanych w dialogu plików, mo¿e byæ NULL</TD></TR>
<TR><TD CLASS=ARGLIST><I>lpstrCustomFilter</I></TD><TD CLASS=ARGLIST>LPTSTR</TD><TD CLASS=ARGLIST>Bufor na filtr zdefiniowany przez u¿ytkownika w trakcie trwania dialogu</TD></TR>
<TR><TD CLASS=ARGLIST><I>nMaxCustFilter</I></TD><TD CLASS=ARGLIST>DWORD</TD><TD CLASS=ARGLIST>Maksymalny rozmiar powy¿szego bufora</TD></TR>
<TR><TD CLASS=ARGLIST><I>nFilterIndex</I></TD><TD CLASS=ARGLIST>DWORD</TD><TD CLASS=ARGLIST>Zawiera indeks filtra wybranego przez u¿ytkownika</TD></TR>
<TR><TD CLASS=ARGLIST><I>lpstrFile</I></TD><TD CLASS=ARGLIST>LPTSTR</TD><TD CLASS=ARGLIST>Najwa¿niejszy element struktury - adres bufora, który bêdzie zawiera³ nazwê(-y) pliku(-ów) wybranego(-ych) przez u¿ytkownika</TD></TR>
<TR><TD CLASS=ARGLIST><I>nMaxFile</I></TD><TD CLASS=ARGLIST>DWORD</TD><TD CLASS=ARGLIST>Maksymalny rozmiar powy¿szego bufora</TD></TR>
<TR><TD CLASS=ARGLIST><I>lpstrFileTitle</I></TD><TD CLASS=ARGLIST>LPTSTR</TD><TD CLASS=ARGLIST>Adres bufora, który po zakoñczeniu dialogu zawiera tytu³ wybranego pliku (nazwê bez œcie¿ki dostêpu)</TD></TR>
<TR><TD CLASS=ARGLIST><I>nMaxFileTitle</I></TD><TD CLASS=ARGLIST>DWORD</TD><TD CLASS=ARGLIST>Maksymalny rozmiar powy¿szego bufora</TD></TR>
<TR><TD CLASS=ARGLIST><I>lpstrInitialDir</I></TD><TD CLASS=ARGLIST>LPCTSTR</TD><TD CLASS=ARGLIST>Startowy katalog dialogu (NULL - bie¿¹cy katalog)</TD></TR>
<TR><TD CLASS=ARGLIST><I>lpstrTitle</I></TD><TD CLASS=ARGLIST>LPCTSTR</TD><TD CLASS=ARGLIST>Tytu³ dialogu (NULL - tytu³ domyœlny)</TD></TR>
<TR><TD CLASS=ARGLIST><I>Flags</I></TD><TD CLASS=ARGLIST>DWORD</TD><TD CLASS=ARGLIST>Ró¿ne flagi :-)</TD></TR>
<TR><TD CLASS=ARGLIST><I>nFileOffset</I></TD><TD CLASS=ARGLIST>WORD</TD><TD CLASS=ARGLIST>Indeks znaku w buforze lpstrFile, od którego zaczyna siê w³aœciwa nazwa (tytu³) pliku</TD></TR>
<TR><TD CLASS=ARGLIST><I>nFileExtension</I></TD><TD CLASS=ARGLIST>WORD</TD><TD CLASS=ARGLIST>Jak wy¿ej, tylko w odniesieniu do rozszerzenia</TD></TR>
<TR><TD CLASS=ARGLIST><I>lpstrDefExt</I></TD><TD CLASS=ARGLIST>LPCTSTR</TD><TD CLASS=ARGLIST>Domyœlne rozszerzenie pliku</TD></TR>
</TABLE>

<P>
A to jeszcze nie wszystko, poda³em tylko najwa¿niejsze pola :D. Na szczêœcie nie musimy tego wszystkiego wype³niaæ jednoczeœnie. Dla œwiêtego spokoju zerujemy wiêc nasz¹ strukturê, coby siê upewniæ, ¿e nie ma w niej ¿adnych losowych œmieci, po czym ustawiamy pole z rozmiarem struktury na odpowiedni¹ wartoœæ:
</P>

<TABLE BORDER WIDTH=100%>
<TR><TD>
ZeroMemory(&ofn, sizeof(ofn));<BR>
ofn.lStructSize = sizeof(ofn);<BR>
</TD></TR>
</TABLE>

<P>
Jeœli u¿ywasz Windows XP (a ze swych tajnych ¿róde³ wiem, ¿e przesz³o po³owa odwiedzaj¹cych moj¹ stronê go u¿ywa ;-)) albo 2000, to pole <SPAN CLASS=T>lStructSize</SPAN> ustawiasz na <SPAN CLASS=T>sizeof(OPENFILENAME)</SPAN>.
</P>
<P>
Jad¹c dalej: pole <SPAN CLASS=T>hwndOwner</SPAN> wype³niamy a¿ po brzegi uchwytem do okna, które wywo³uje dialog wyboru pliku. Nastêpnie trzeba zdefiniowaæ <SPAN CLASS=Wazne>filtr</SPAN>. Jest to ci¹g par ³añcuchów, które... Aaa, co bêdê siê sili³ na uczone formu³ki, najlepiej podam od razu przyk³ad takiego filtru:
</P>

<P>
<SPAN CLASS=Wazne>
Bitmapy (*.bmp)|*.bmp<BR>
Pliki tekstowe (*.txt)|*.txt<BR>
Dokumenty internetowe (*.htm; *.html)|*.htm;*.html<BR>
Wszystkie pliki|*.*<BR>
</SPAN>
</P>

<P>
Teraz chyba ³apiesz ;-). Tak, filtr s³u¿y do wyœwietlania tylko plików danego rodzaju. 
Lewa czêœæ to opis filtru, czyli tekst, który pojawia siê w ComboBox-ie na dole dialogu. Prawa czêœæ to w³aœciwy filtr, czyli maska, sk³adaj¹ca siê najczêœciej z gwiazdki i rozszerzenia. Mo¿emy podaæ kilka masek oddzielonych œrednikiem, tak jak powy¿ej w przypadku plików HTML. Poszczególne pary filtrów powinno siê oddzielaæ znakami zerowymi, ja wypisa³em je w oddzielnych linijkach, dla lepszej czytelnoœci. Praw¹ czêœæ ka¿dej pary oddziela siê od lewej znakiem zerowym, ja u¿y³em powy¿ej znaku |. Na samym koñcu filtru dajemy podwójny znak zerowy.
</P>
<P>
Có¿, ca³e to filtrowanie mo¿e wygl¹daæ na bardzo skomplikowane, ale w istocie nie jest tak Ÿle. Przekonasz siê, kiedy zaczniesz sam to robiæ. Mo¿e zreszt¹ wystarczy ci spojrzeæ na ma³y przyk³adzik:
</P>

<TABLE BORDER WIDTH=100%>
<TR><TD>
ofn.lpstrFilter = <SPAN CLASS=L>"Pliki tekstowe (*.txt)\0*.txt\0Wszystkie pliki\0*.*\0"</SPAN>;<BR>
</TD></TR>
</TABLE>

<P>
Okiem zwyk³ego cz³owieka jest to tak zwany szum informacyjny, okiem rasowego kodera jest to zupe³nie przejrzysty i czytelny filtr :-). Sekwencje ucieczki <SPAN CLASS=L>\0</SPAN> to oczywiœcie terminalne znaki zerowe, które w wiêkszoœci przypadków oznaczaj¹ Absolutny Koniec Stringa, natomiast tutaj pe³ni¹ rolê separatorów, zaœ "prawdziwy" znak terminalny jest podwójny. Wprawdzie na koñcu widaæ tylko jedn¹ sekwencjê <SPAN CLASS=L>\0</SPAN>, ale jak wiemy, kompilator zawsze dostawia jeszcze jeden znak zerowy na koñcu ka¿dego stringa w instrukcji przypisania.
</P>

<P>
Pora zaj¹æ siê najwa¿niejszym, czyli nazw¹ pliku, bo przecie¿ w³aœnie po to, ¿eby j¹ uzyskaæ od u¿ytkownika, wyœwietlamy ca³y ten dialog. Potrzebny nam bêdzie na ni¹ bufor. Najlepiej go zrobiæ tak:
</P>

<TABLE BORDER WIDTH=100%>
<TR><TD>
<SPAN CLASS=K>char</SPAN> sNazwaPliku[MAX_PATH] = <SPAN CLASS=L>""</SPAN>;
</TD></TR>
</TABLE>

<P>
U¿yliœmy systemowej sta³ej <SPAN CLASS=T>MAX_PATH</SPAN>, dziêki czemu mamy pewnoœæ, ¿e nasz dialog nie bêdzie u¿ywa³ zbyt d³ugich nazw œcie¿ek. Maksymalny rozmiar bufora oraz jego adres trzeba teraz wstawiæ do naszej struktury:
</P>

<TABLE BORDER WIDTH=100%>
<TR><TD>
ofn.nMaxFile = MAX_PATH;<BR>
ofn.lpstrFile = sNazwaPliku;<BR>
</TD></TR>
</TABLE>

<P>
Warto jeszcze ustawiæ domyœlne rozszerzenie. To dla czystej wygody u¿ytkownika, a zarazem jest to pewne zabezpieczenie przed lamerami - jak wiadomo, Windows ma opcjê ukrywania rozszerzeñ plików (z której oczywiœcie ¿aden szanuj¹cy siê Fachowiec nie korzysta, ale nie ka¿dy jest wszak Fachowcem ;-)), która to opcja powoduje czasem niez³e zamieszanie. Na wypadek wiêc, gdyby ktoœ wpisa³ sam¹ nazwê bez rozszerzenia, ustawienie rozszerzenia domyœlnego (które w takim wypadku zostanie automatycznie do³¹czone do wpisanej nazwy pliku) zwiêksza prawdopodobieñstwo unikniêcia b³êdu w rodzaju <SPAN CLASS=Inglisz>file not found</SPAN>:
</P>

<TABLE BORDER WIDTH=100%>
<TR><TD>
ofn.lpstrDefExt = <SPAN CLASS=L>"txt"</SPAN>;<BR>
</TD></TR>
</TABLE>

<P>
Pozostaje ju¿ tylko zaj¹æ siê flagami. Oto najwa¿niejsze z nich:
</P>

<TABLE WIDTH=100%>
<TR><TD CLASS=ARGLIST COLSPAN=2>
<SPAN CLASS=K>int</SPAN> CreateDialog(<I>HINSTANCE hInstance, LPCTSTR lpTemplate, HWND hWndParent, DLGPROC lpDialogFunc</I>)
</TD></TR><TR></TR><TR></TR><TR></TR>
<TR><TH CLASS=ARGLIST>Sta³a</TH><TH CLASS=ARGLIST>Znaczenie</TH></TR>
<TR><TD CLASS=ARGLIST><I>OFN_ALLOWMULTISELECT</I></TD><TD CLASS=ARGLIST>Pozwala na zaznaczanie wielu plików jednoczeœnie</TD></TR>
<TR><TD CLASS=ARGLIST><I>OFN_CREATEPROMPT</I></TD><TD CLASS=ARGLIST>W razie gdyby plik o wpisanej przez u¿ytkownika nazwie nie istnia³, powoduje, ¿e system pyta czy utworzyæ taki plik</TD></TR>
<TR><TD CLASS=ARGLIST><I>OFN_EXTENSIONDIFFERENT</I></TD><TD CLASS=ARGLIST>Okreœla, ¿e u¿ytkownik wybra³ plik o rozszerzeniu innym ni¿ domyœlne (o ile podano domyœlne, rzecz jasna)</TD></TR>
<TR><TD CLASS=ARGLIST><I>OFN_FILEMUSTEXIST</I></TD><TD CLASS=ARGLIST>Plik o podanej nazwie musi istnieæ. W przeciwnym wypadku zostaje wyœwietlone ostrze¿enie. Ustawienie tej flagi powoduje automatyczne w³¹czenie OFN_PATHMUSTEXIST (co jest doœæ logiczne ;-))</TD></TR>
<TR><TD CLASS=ARGLIST><I>OFN_HIDEREADONLY</I></TD><TD CLASS=ARGLIST>Ukrywa pole "Tylko do odczytu", pokazywane czasem pod polem wyboru filtru</TD></TR>
<TR><TD CLASS=ARGLIST><I>OFN_NOCHANGEDIR</I></TD><TD CLASS=ARGLIST>Nie pozwala na zmianê katalogu</TD></TR>
<TR><TD CLASS=ARGLIST><I>OFN_NODEREFERENCELINKS</I></TD><TD CLASS=ARGLIST>Okreœla sposób traktowania skrótów (*.lnk). Jeœli ta flaga jest ustawiona, to dialog zwraca nazwê wybranego pliku *.lnk (czyli traktuje go jak zwyk³y plik), w przeciwnym wypadku zwraca nazwê pliku, do którego odnosi siê ten skrót</TD></TR>
<TR><TD CLASS=ARGLIST><I>OFN_NONETWORKBUTTON</I></TD><TD CLASS=ARGLIST>Ukrywa przycisk "Otoczenie sieciowe"</TD></TR>
<TR><TD CLASS=ARGLIST><I>OFN_OVERWRITEPROMPT</I></TD><TD CLASS=ARGLIST>Jeœli nasz dialog to "Zapisz jako...", to ta flaga sprawia, ¿e w przypadku próby nadpisania istniej¹cego pliku pokazywany jest komunikat z pytaniem, czy na pewno :-)</TD></TR>
<TR><TD CLASS=ARGLIST><I>OFN_PATHMUSTEXIST</I></TD><TD CLASS=ARGLIST>Nietrudno siê domyœliæ :-)</TD></TR>
<TR><TD CLASS=ARGLIST><I>OFN_READONLY</I></TD><TD CLASS=ARGLIST>Zaznacza pole "Tylko do odczytu" (jeœli u¿yjemy tej flagi przed pokazaniem dialogu) lub wskazuje, czy to pole zosta³o zaznaczone przez u¿ytkownika (jeœli u¿yjemy jej po pokazaniu dialogu)</TD></TR>
<TR><TD CLASS=ARGLIST><I>OFN_SHOWHELP</I></TD><TD CLASS=ARGLIST>Pokazuje przycisk "Pomoc"</TD></TR>
</TABLE>
 
<P>
¯eby otworzyæ plik tekstowy i wyœwietliæ jego zawartoœæ w oknie, na pewno potrzebna nam bêdzie flaga <SPAN CLASS=T>OFN_FILEMUSTEXIST</SPAN> (bo nic dobrego siê nie stanie, jeœli spróbujemy otworzyæ nieistniej¹cy plik :-)). Nie zaszkodzi te¿ ustawiæ <SPAN CLASS=T>OFN_HIDEREADONLY</SPAN>. Tak wiêc wype³nienie pola <SPAN CLASS=T>Flags</SPAN> bêdzie wygl¹da³o nastêpuj¹co:
</P>

<TABLE BORDER WIDTH=100%>
<TR><TD>
ofn.Flags = OFN_FILEMUSTEXIST | OFN_HIDEREADONLY;<BR>
</TD></TR>
</TABLE>

<P>
Mamy ustawione co trzeba, teraz musimy jeszcze wywo³aæ nasz dialog. Ju¿ wiemy, ¿e robi to funkcja <SPAN CLASS=T>GetOpenFileName</SPAN> lub <SPAN CLASS=T>GetSaveFileName</SPAN>. Jeœli jednak nie chcemy wyjœæ na kompletnych lamerów, musimy siê jeszcze zaj¹æ wartoœciami, zwracanymi przez te funkcje. Wynosz¹ one <SPAN CLASS=L>0</SPAN>, jeœli u¿ytkownik nie wybra³ ¿adnego pliku (czyli albo wcisn¹³ 'Anuluj', albo zamkn¹³ dialog, albo spowodowa³ jakiœ b³¹d), natomiast jeœli wszystko jest w porz¹dku, to wartoœæ zwrócona jest niezerowa. 
</P>
<P>
Co do b³êdów, nie jest tajemnic¹, ¿e we wszelkich kontaktach z plikami mo¿na ich spowodowaæ ca³e mnóstwo. Predefiniowane dialogi maj¹ wiêc swoj¹ w³asn¹ funkcjê do wykrywania b³êdów, nazywa siê ona <SPAN CLASS=T>CommDlgExtendedError</SPAN>. Dok³adny opis zwracanych przez ni¹ wartoœci znajdziesz jak zawsze w MSDN, natomiast najbardziej "popularne" b³êdy to:
</P>

<TABLE WIDTH=100%>
<TR><TH CLASS=ARGLIST>Sta³a</TH><TH CLASS=ARGLIST>Znaczenie</TH></TR>
<TR><TD CLASS=ARGLIST><I>0</I></TD><TD CLASS=ARGLIST>U¿ytkownik nie wybra³ pliku</TD></TR>
<TR><TD CLASS=ARGLIST><I>FNERR_BUFFERTOOSMALL</I></TD><TD CLASS=ARGLIST>Wybrana przez u¿ytkownika nazwa pliku nie mieœci siê w buforze</TD></TR>
<TR><TD CLASS=ARGLIST><I>FNERR_INVALIDFILENAME</I></TD><TD CLASS=ARGLIST>Podana przed u¿ytkownika nazwa pliku jest nieprawid³owa</TD></TR>
</TABLE>

<P>
Z w³asnych niezbyt mi³ych doœwiadczeñ wiem te¿, ¿e równie czêsto przy korzystaniu dialogów mog¹ wyst¹piæ ró¿ne "dziwne" b³êdy, które powoduj¹, ¿e dialog w ogóle siê nie wyœwietla. Na przyk³ad jeœli zapomnimy wyzerowaæ bufor podawany w <SPAN CLASS=T>lpstrFile</SPAN>, to funkcja <SPAN CLASS=T>GetOpenFileName</SPAN> wróci natychmiast z wartoœci¹ <SPAN CLASS=T>FNERR_INVALIDFILENAME</SPAN> bez wyœwietlania czegokolwiek. Warto zajrzeæ do MSDN do opisu funkcji <SPAN CLASS=T>CommDlgExtendedError</SPAN> i zapoznaæ siê tak¿e z list¹ b³êdów, rozpoczynaj¹cych siê przedrostkiem <SPAN CLASS=T>CDERR_</SPAN>. 
</P>
<P>
Chyba wystarczy ju¿ o tych b³êdach, bo jeszcze coœ wykrakamy ;-). Przystêpujemy do realizacji naszego wielkiego zadania, czyli stworzenia naszej Jednej Szesnastej Notatnika :-). Jak zwykle do³o¿y³em wszelkich starañ, ¿ebym nie musia³ siê zbytnio staraæ i przedstawiê ci tylko najbardziej niezbêdne fragmenty kodu. Jak wczytaæ plik - ju¿ wiesz, wystarczy zrobiæ z tego osobn¹ funkcjê, nazwiemy j¹ sobie <SPAN CLASS=T>WczytajPlik</SPAN>. Bêdzie ona pobiera³a uchwyt okna, do którego ma wczytaæ tekst oraz nazwê pliku. Oczywiœcie szkieletowego kodu okienkowej aplikacji te¿ nie bêdê po raz setny wstawia³. Wszystko poza tymi dwiema rzeczami masz tutaj. Najpierw tworzenie kontrolki <SPAN CLASS=T>EDIT</SPAN> i ustawienie jej rozmiarów na rozmiar okna g³ównego, tego chyba nie muszê omawiaæ:
</P>

<TABLE BORDER WIDTH=100%>
<TR><TD>
hEdit = CreateWindowEx(WS_EX_CLIENTEDGE, <SPAN CLASS=L>"EDIT"</SPAN>, <SPAN CLASS=L>"Tu bêdzie tekst z pliku"</SPAN>, WS_CHILD | WS_VISIBLE | WS_BORDER | ES_MULTILINE | WS_VSCROLL | ES_AUTOVSCROLL, <SPAN CLASS=L>5,5,5,5</SPAN>, hwnd, NULL, hThisInstance, NULL);<BR>
RECT rcClient;<BR>
GetClientRect(hwnd, &rcClient);<BR>
MoveWindow(hEdit, <SPAN CLASS=L>0, 0</SPAN>, rcClient.right, rcClient.bottom-<SPAN CLASS=L>30</SPAN>, TRUE);<BR>
</TD></TR>
</TABLE>

<P>
No, mo¿e jedn¹ rzecz wyt³umaczyæ trzeba. U¿yliœmy tu funkcji <SPAN CLASS=T>MoveWindow</SPAN>. Jak sama nazwa wskazuje, s³u¿y ona do przemieszczania okna, ale przy okazji ustawia te¿ now¹ szerokoœæ i wysokoœæ dla tego okna. Tutaj chcemy powiêkszyæ EDIT-a na ca³y obszar klienta naszego g³ównego okna, zatem pobieramy wymiary tego ostatniego funkcj¹ <SPAN CLASS=T>GetClientRect</SPAN>. Ostatni argument funkcji <SPAN CLASS=T>MoveWindow</SPAN> to flaga, która okreœla, czy po zmianie wymiarów okno ma byæ odmalowane. Czemu nie, mo¿emy odmalowaæ, wiêc ustawiamy <SPAN CLASS=T>TRUE</SPAN>. Pamiêtaj, by zadeklarowaæ zmienn¹<SPAN CLASS=T>hEdit</SPAN> w zasiêgu globalnym.
</P>
<P>
Nastêpnie tworzymy przycisk, który bêdzie nam wywo³ywa³ dialog. Tu te¿ nie ma ¿adnych filozofii:
</P>

<TABLE BORDER WIDTH=100%>
<TR><TD>
CreateWindowEx(<SPAN CLASS=L>0, "BUTTON", "Plik..."</SPAN>, WS_CHILD | WS_VISIBLE | WS_BORDER, <SPAN CLASS=L>0</SPAN>, rcClient.bottom-<SPAN CLASS=L>27, 50, 25</SPAN>, hwnd, NULL, hThisInstance, NULL);
</TD></TR>
</TABLE>

<P>
Po trzecie (i najwa¿niejsze) - reakcja na przycisk, czyli pokazanie dialogu wyboru pliku, po czym wczytanie tego pliku i wywalenie jego cennej zawartoœci do pola tekstowego:
</P>

<TABLE BORDER WIDTH=100%>
<TR><TD>
<SPAN CLASS=K>case</SPAN> WM_COMMAND:<BR>
{<BR>
&nbsp;OPENFILENAME ofn;<BR>
&nbsp;<SPAN CLASS=K>char</SPAN> sNazwaPliku[MAX_PATH] = <SPAN CLASS=L>""</SPAN>;<BR>
<BR>
&nbsp;ZeroMemory(&ofn, sizeof(ofn));<BR>
&nbsp;ofn.lStructSize = sizeof(ofn);<BR>
&nbsp;ofn.lpstrFilter = <SPAN CLASS=L>"Pliki tekstowe (*.txt)\0*.txt\0Wszystkie pliki\0*.*\0"</SPAN>;<BR>
&nbsp;ofn.nMaxFile = MAX_PATH;<BR>
&nbsp;ofn.lpstrFile = sNazwaPliku;<BR>
&nbsp;ofn.lpstrDefExt = <SPAN CLASS=L>"txt"</SPAN>;<BR>
&nbsp;ofn.Flags = OFN_FILEMUSTEXIST | OFN_HIDEREADONLY;<BR>
&nbsp;<SPAN CLASS=K>if</SPAN>(GetOpenFileName(&ofn))<BR>
&nbsp;{<BR>
&nbsp;&nbsp;WczytajPlik(sNazwaPliku, hEdit);<BR>
&nbsp;}<BR>
}<BR>
<SPAN CLASS=K>break</SPAN>;<BR>
</TD></TR>
</TABLE>

<P>
I to by by³o tyle o dialogach wyboru pliku. 
</P>


<HR COLOR=GRAY WIDTH=90% SIZE=1>
<TABLE ALIGN=CENTER>
<TR>
<TD CLASS=TDN>
<A HREF="apidlg2.html">&lt;&lt; Poprzednia czêœæ kursu</A> &nbsp;
<A HREF="../winapi.html">Spis</A> &nbsp;
<A HREF="../index.html" TARGET="_top">Strona g³ówna</A> &nbsp;
<A HREF="apidlg4.html">Nastêpna czêœæ kursu &gt;&gt;</A> &nbsp;
</TD>
</TR>
</TABLE>